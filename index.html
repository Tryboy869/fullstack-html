<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ratio Wrapper - Anti-Hallucination System</title>
    
    <!-- Frameworks Core -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Utilitaires -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://unpkg.com/dayjs@1.11.9/dayjs.min.js"></script>
    <script src="https://unpkg.com/uuid@9.0.0/dist/umd/uuidv4.min.js"></script>
    
    <!-- Database Locale -->
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    
    <!-- Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Machine Learning -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    
    <!-- Crypto pour s√©curit√© -->
    <script src="https://unpkg.com/crypto-js@4.1.1/crypto-js.js"></script>
    
    <style>
        .glass {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .ai-node {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .ai-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .ratio-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .pulse-ai {
            animation: pulse-ai 2s infinite;
        }
        
        @keyframes pulse-ai {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .neural-bg {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        }
        
        .code-font {
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900 min-h-screen">
    
    <div id="app" class="min-h-screen">
        <!-- Header Syst√®me -->
        <header class="glass border-b border-white/20 backdrop-blur-xl">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                            <span class="text-white font-bold text-lg">ü§ñ</span>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-white">AI Ratio Wrapper</h1>
                            <p class="text-purple-200 text-sm">Anti-Hallucination System v1.0</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <div class="text-green-400 font-semibold">{{ systemStatus }}</div>
                            <div class="text-purple-200 text-sm">{{ totalRequests }} requ√™tes trait√©es</div>
                        </div>
                        <div class="w-3 h-3 rounded-full bg-green-400 pulse-ai"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="border-b border-white/10">
            <div class="container mx-auto px-6 py-3">
                <div class="flex space-x-1">
                    <button @click="currentView = 'dashboard'" 
                            :class="currentView === 'dashboard' ? 'bg-purple-600 text-white' : 'text-purple-200 hover:bg-white/10'"
                            class="px-4 py-2 rounded-lg transition-all duration-200 font-medium">
                        üìä Dashboard
                    </button>
                    <button @click="currentView = 'wrapper'" 
                            :class="currentView === 'wrapper' ? 'bg-purple-600 text-white' : 'text-purple-200 hover:bg-white/10'"
                            class="px-4 py-2 rounded-lg transition-all duration-200 font-medium">
                        ü§ñ AI Wrapper
                    </button>
                    <button @click="currentView = 'ratios'" 
                            :class="currentView === 'ratios' ? 'bg-purple-600 text-white' : 'text-purple-200 hover:bg-white/10'"
                            class="px-4 py-2 rounded-lg transition-all duration-200 font-medium">
                        ‚öñÔ∏è Ratio Config
                    </button>
                    <button @click="currentView = 'audit'" 
                            :class="currentView === 'audit' ? 'bg-purple-600 text-white' : 'text-purple-200 hover:bg-white/10'"
                            class="px-4 py-2 rounded-lg transition-all duration-200 font-medium">
                        üìã Audit Trail
                    </button>
                    <button @click="currentView = 'api'" 
                            :class="currentView === 'api' ? 'bg-purple-600 text-white' : 'text-purple-200 hover:bg-white/10'"
                            class="px-4 py-2 rounded-lg transition-all duration-200 font-medium">
                        üåê API Endpoint
                    </button>
                </div>
            </div>
        </nav>

        <!-- Dashboard View -->
        <div v-if="currentView === 'dashboard'" class="container mx-auto px-6 py-8">
            <!-- M√©triques Principales -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="glass rounded-xl p-6 ai-node">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-lg bg-green-500/20 flex items-center justify-center">
                            <span class="text-2xl">‚úÖ</span>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-white">{{ accuracyRate }}%</div>
                            <div class="text-green-400 text-sm">Pr√©cision</div>
                        </div>
                    </div>
                </div>
                
                <div class="glass rounded-xl p-6 ai-node">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-lg bg-red-500/20 flex items-center justify-center">
                            <span class="text-2xl">‚ö†Ô∏è</span>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-white">{{ hallucinationRate }}%</div>
                            <div class="text-red-400 text-sm">Hallucinations</div>
                        </div>
                    </div>
                </div>
                
                <div class="glass rounded-xl p-6 ai-node">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-lg bg-blue-500/20 flex items-center justify-center">
                            <span class="text-2xl">ü§ñ</span>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-white">{{ activeModels }}</div>
                            <div class="text-blue-400 text-sm">Mod√®les Actifs</div>
                        </div>
                    </div>
                </div>
                
                <div class="glass rounded-xl p-6 ai-node">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-lg bg-purple-500/20 flex items-center justify-center">
                            <span class="text-2xl">‚ö°</span>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-white">{{ avgResponseTime }}ms</div>
                            <div class="text-purple-400 text-sm">Temps Moyen</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Graphique Performance -->
            <div class="glass rounded-xl p-6 mb-8">
                <h3 class="text-xl font-bold text-white mb-6">üìà Performance en Temps R√©el</h3>
                <div class="h-64">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <!-- Status des Mod√®les -->
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-6">ü§ñ Status des Mod√®les IA</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div v-for="model in aiModels" :key="model.id" class="bg-white/5 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="font-semibold text-white">{{ model.name }}</div>
                            <div :class="model.status === 'active' ? 'bg-green-500' : 'bg-red-500'" 
                                 class="w-3 h-3 rounded-full"></div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-300">Ratio Actuel</span>
                                <span class="text-white font-medium">{{ model.currentRatio }}</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div class="ratio-bar bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full" 
                                     :style="`width: ${model.currentRatio * 100}%`"></div>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-300">Pr√©cision</span>
                                <span class="text-green-400">{{ model.accuracy }}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Wrapper Interface -->
        <div v-if="currentView === 'wrapper'" class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Interface de Requ√™te -->
                <div class="glass rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-6">üí¨ Tester le Wrapper IA</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-purple-200 text-sm font-medium mb-2">Mode de Traitement</label>
                            <select v-model="processingMode" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white">
                                <option value="factual">üéØ Factuel (Ratios Conservateurs)</option>
                                <option value="creative">üé® Cr√©atif (Ratios √âquilibr√©s)</option>
                                <option value="hybrid">‚öñÔ∏è Hybride (Adaptatif)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-purple-200 text-sm font-medium mb-2">Votre Requ√™te</label>
                            <textarea v-model="userQuery" 
                                      class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white h-32 resize-none"
                                      placeholder="Posez votre question ici..."></textarea>
                        </div>
                        
                        <button @click="processQuery" 
                                :disabled="isProcessing"
                                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200">
                            <span v-if="!isProcessing">üöÄ Traiter avec IA Wrapper</span>
                            <span v-else>‚è≥ Traitement en cours...</span>
                        </button>
                    </div>
                </div>

                <!-- R√©sultats -->
                <div class="glass rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-6">üìä R√©sultat Analys√©</h3>
                    
                    <div v-if="lastResult" class="space-y-4">
                        <div class="bg-white/5 rounded-lg p-4">
                            <div class="text-sm text-purple-200 mb-2">R√©ponse Finale</div>
                            <div class="text-white">{{ lastResult.finalResponse }}</div>
                        </div>
                        
                        <div class="bg-white/5 rounded-lg p-4">
                            <div class="text-sm text-purple-200 mb-3">Distribution des Ratios</div>
                            <div class="space-y-2">
                                <div v-for="model in lastResult.modelContributions" :key="model.name" class="flex items-center justify-between">
                                    <span class="text-white text-sm">{{ model.name }}</span>
                                    <span class="text-purple-300">{{ (model.ratio * 100).toFixed(1) }}%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-green-500/20 rounded-lg p-3 text-center">
                                <div class="text-green-400 font-bold">{{ lastResult.confidenceScore }}%</div>
                                <div class="text-green-300 text-sm">Confiance</div>
                            </div>
                            <div class="bg-blue-500/20 rounded-lg p-3 text-center">
                                <div class="text-blue-400 font-bold">{{ lastResult.processingTime }}ms</div>
                                <div class="text-blue-300 text-sm">Temps</div>
                            </div>
                        </div>
                    </div>
                    
                    <div v-else class="text-center py-8 text-gray-400">
                        Aucun r√©sultat pour le moment
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration des Ratios -->
        <div v-if="currentView === 'ratios'" class="container mx-auto px-6 py-8">
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-6">‚öñÔ∏è Configuration des Ratios Adaptatifs</h3>
                
                <div class="space-y-6">
                    <div v-for="model in aiModels" :key="model.id" class="bg-white/5 rounded-lg p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold text-white">{{ model.name }}</h4>
                            <button @click="toggleModel(model.id)" 
                                    :class="model.status === 'active' ? 'bg-green-600' : 'bg-gray-600'"
                                    class="px-3 py-1 rounded-lg text-white text-sm">
                                {{ model.status === 'active' ? 'Actif' : 'Inactif' }}
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-purple-200 text-sm mb-2">Ratio Factuel</label>
                                <input type="range" 
                                       v-model="model.ratios.factual" 
                                       min="0" max="1" step="0.1"
                                       class="w-full">
                                <div class="text-center text-white text-sm mt-1">{{ model.ratios.factual }}</div>
                            </div>
                            
                            <div>
                                <label class="block text-purple-200 text-sm mb-2">Ratio Cr√©atif</label>
                                <input type="range" 
                                       v-model="model.ratios.creative" 
                                       min="0" max="1" step="0.1"
                                       class="w-full">
                                <div class="text-center text-white text-sm mt-1">{{ model.ratios.creative }}</div>
                            </div>
                            
                            <div>
                                <label class="block text-purple-200 text-sm mb-2">Priorit√©</label>
                                <input type="range" 
                                       v-model="model.priority" 
                                       min="1" max="10" step="1"
                                       class="w-full">
                                <div class="text-center text-white text-sm mt-1">{{ model.priority }}/10</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end mt-6">
                    <button @click="saveRatioConfig" 
                            class="bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white font-bold py-2 px-6 rounded-lg">
                        üíæ Sauvegarder Configuration
                    </button>
                </div>
            </div>
        </div>

        <!-- Audit Trail -->
        <div v-if="currentView === 'audit'" class="container mx-auto px-6 py-8">
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-6">üìã Journal d'Audit</h3>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left py-3 px-4 text-purple-200">Timestamp</th>
                                <th class="text-left py-3 px-4 text-purple-200">Requ√™te</th>
                                <th class="text-left py-3 px-4 text-purple-200">Mode</th>
                                <th class="text-left py-3 px-4 text-purple-200">Confiance</th>
                                <th class="text-left py-3 px-4 text-purple-200">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="entry in auditLog" :key="entry.id" class="border-b border-white/10 hover:bg-white/5">
                                <td class="py-3 px-4 text-white text-sm code-font">{{ entry.timestamp }}</td>
                                <td class="py-3 px-4 text-white max-w-xs truncate">{{ entry.query }}</td>
                                <td class="py-3 px-4">
                                    <span :class="getModeColor(entry.mode)" class="px-2 py-1 rounded text-xs">
                                        {{ entry.mode }}
                                    </span>
                                </td>
                                <td class="py-3 px-4 text-white">{{ entry.confidence }}%</td>
                                <td class="py-3 px-4">
                                    <button @click="viewDetails(entry.id)" class="text-blue-400 hover:text-blue-300 text-sm">
                                        D√©tails
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- API Endpoint Interface -->
        <div v-if="currentView === 'api'" class="container mx-auto px-6 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-6">üåê API Endpoint</h3>
                    
                    <div class="space-y-4">
                        <div class="bg-gray-800 rounded-lg p-4">
                            <div class="text-sm text-purple-200 mb-2">Endpoint URL</div>
                            <div class="code-font text-green-400 text-sm break-all">{{ apiEndpoint }}</div>
                        </div>
                        
                        <div class="bg-gray-800 rounded-lg p-4">
                            <div class="text-sm text-purple-200 mb-2">Example Request</div>
                            <pre class="code-font text-green-400 text-sm overflow-x-auto">{{ apiExample }}</pre>
                        </div>
                        
                        <div class="space-y-2">
                            <div class="text-sm text-purple-200">API Status</div>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 rounded-full bg-green-400"></div>
                                <span class="text-white">Actif - {{ totalRequests }} requ√™tes trait√©es</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="glass rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-6">üìä M√©triques API</h3>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-white/5 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-400">{{ apiMetrics.requestsToday }}</div>
                            <div class="text-purple-200 text-sm">Requ√™tes Aujourd'hui</div>
                        </div>
                        <div class="bg-white/5 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-400">{{ apiMetrics.avgResponseTime }}ms</div>
                            <div class="text-purple-200 text-sm">Temps Moyen</div>
                        </div>
                        <div class="bg-white/5 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-400">{{ apiMetrics.successRate }}%</div>
                            <div class="text-purple-200 text-sm">Taux de Succ√®s</div>
                        </div>
                        <div class="bg-white/5 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-red-400">{{ apiMetrics.errorRate }}%</div>
                            <div class="text-purple-200 text-sm">Taux d'Erreur</div>
                        </div>
                    </div>
                    
                    <div class="bg-white/5 rounded-lg p-4">
                        <div class="text-sm text-purple-200 mb-3">Derni√®res Requ√™tes</div>
                        <div class="space-y-2 max-h-32 overflow-y-auto">
                            <div v-for="req in recentRequests" :key="req.id" class="flex justify-between text-sm">
                                <span class="text-white truncate">{{ req.path }}</span>
                                <span :class="req.status === 200 ? 'text-green-400' : 'text-red-400'">{{ req.status }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentView: 'dashboard',
                    systemStatus: 'Op√©rationnel',
                    totalRequests: 1247,
                    accuracyRate: 94.7,
                    hallucinationRate: 5.3,
                    activeModels: 3,
                    avgResponseTime: 234,
                    
                    // AI Models Configuration
                    aiModels: [
                        {
                            id: 1,
                            name: 'GPT-4 Turbo',
                            status: 'active',
                            currentRatio: 0.4,
                            accuracy: 94.2,
                            ratios: { factual: 0.5, creative: 0.3 },
                            priority: 8
                        },
                        {
                            id: 2,
                            name: 'Claude 3.5',
                            status: 'active',
                            currentRatio: 0.35,
                            accuracy: 96.1,
                            ratios: { factual: 0.4, creative: 0.4 },
                            priority: 9
                        },
                        {
                            id: 3,
                            name: 'Gemini Pro',
                            status: 'active',
                            currentRatio: 0.25,
                            accuracy: 91.8,
                            ratios: { factual: 0.3, creative: 0.5 },
                            priority: 7
                        }
                    ],
                    
                    // Wrapper Interface
                    processingMode: 'factual',
                    userQuery: '',
                    isProcessing: false,
                    lastResult: null,
                    
                    // Audit Log
                    auditLog: [
                        {
                            id: 1,
                            timestamp: '2025-01-15 14:32:15',
                            query: 'Quelle est la capitale de la France ?',
                            mode: 'factual',
                            confidence: 98.5
                        },
                        {
                            id: 2,
                            timestamp: '2025-01-15 14:28:42',
                            query: '√âcris un po√®me sur l\'IA',
                            mode: 'creative',
                            confidence: 87.3
                        },
                        {
                            id: 3,
                            timestamp: '2025-01-15 14:25:18',
                            query: 'Analyse les tendances du march√© crypto',
                            mode: 'hybrid',
                            confidence: 92.1
                        }
                    ],
                    
                    // API Metrics
                    apiEndpoint: window.location.origin + '/api/v1/wrapper',
                    apiExample: `curl -X POST "${window.location.origin}/api/v1/wrapper" \\
  -H "Content-Type: application/json" \\
  -d '{
    "query": "Votre question ici",
    "mode": "factual",
    "options": {
      "max_tokens": 500,
      "temperature": 0.3
    }
  }'`,
                    apiMetrics: {
                        requestsToday: 1247,
                        avgResponseTime: 234,
                        successRate: 99.2,
                        errorRate: 0.8
                    },
                    recentRequests: [
                        { id: 1, path: '/api/v1/wrapper', status: 200 },
                        { id: 2, path: '/api/v1/wrapper', status: 200 },
                        { id: 3, path: '/api/v1/ratios', status: 200 },
                        { id: 4, path: '/api/v1/wrapper', status: 429 },
                        { id: 5, path: '/api/v1/health', status: 200 }
                    ]
                }
            },
            
            mounted() {
                this.initializeSystem();
                this.setupAPIEndpoints();
                this.startRealTimeUpdates();
            },
            
            methods: {
                // Initialisation du syst√®me
                initializeSystem() {
                    console.log('üöÄ AI Ratio Wrapper System Initialized');
                    this.updatePerformanceChart();
                },
                
                // Configuration des endpoints API
                setupAPIEndpoints() {
                    const self = this;
                    
                    // Simulation d'un serveur API interne
                    window.aiWrapperAPI = {
                        // Endpoint principal du wrapper
                        async processQuery(query, mode = 'factual', options = {}) {
                            const startTime = performance.now();
                            
                            try {
                                // Simulation de traitement IA avec ratios adaptatifs
                                const result = await self.simulateAIProcessing(query, mode);
                                const processingTime = Math.round(performance.now() - startTime);
                                
                                // Log pour audit
                                const auditEntry = {
                                    id: Date.now(),
                                    timestamp: dayjs().format('YYYY-MM-DD HH:mm:ss'),
                                    query: query.substring(0, 100) + (query.length > 100 ? '...' : ''),
                                    mode: mode,
                                    confidence: result.confidenceScore,
                                    processingTime: processingTime
                                };
                                
                                self.auditLog.unshift(auditEntry);
                                if (self.auditLog.length > 100) self.auditLog.pop();
                                
                                // Mise √† jour m√©triques
                                self.totalRequests++;
                                self.updateMetrics(result);
                                
                                return {
                                    success: true,
                                    data: result,
                                    timestamp: new Date().toISOString(),
                                    processingTime: processingTime
                                };
                                
                            } catch (error) {
                                console.error('AI Wrapper Error:', error);
                                return {
                                    success: false,
                                    error: error.message,
                                    timestamp: new Date().toISOString()
                                };
                            }
                        },
                        
                        // Endpoint de configuration des ratios
                        async updateRatios(ratioConfig) {
                            try {
                                self.aiModels.forEach(model => {
                                    if (ratioConfig[model.id]) {
                                        Object.assign(model, ratioConfig[model.id]);
                                    }
                                });
                                
                                return { success: true, message: 'Ratios updated successfully' };
                            } catch (error) {
                                return { success: false, error: error.message };
                            }
                        },
                        
                        // Endpoint de sant√© du syst√®me
                        async getHealthStatus() {
                            return {
                                status: 'healthy',
                                uptime: '99.9%',
                                activeModels: self.aiModels.filter(m => m.status === 'active').length,
                                totalRequests: self.totalRequests,
                                lastCheck: new Date().toISOString()
                            };
                        },
                        
                        // Endpoint d'audit
                        async getAuditLog(limit = 50) {
                            return {
                                logs: self.auditLog.slice(0, limit),
                                total: self.auditLog.length
                            };
                        }
                    };
                    
                    // Exposition de l'API via routes HTTP simul√©es
                    this.exposeHTTPEndpoints();
                },
                
                // Exposition des endpoints HTTP
                exposeHTTPEndpoints() {
                    const self = this;
                    
                    // Intercept fetch requests pour notre API
                    const originalFetch = window.fetch;
                    window.fetch = async function(url, options = {}) {
                        // Check si c'est une requ√™te vers notre API
                        if (url.includes('/api/v1/')) {
                            const apiPath = url.split('/api/v1/')[1];
                            
                            try {
                                let result;
                                const body = options.body ? JSON.parse(options.body) : {};
                                
                                switch (apiPath) {
                                    case 'wrapper':
                                        if (options.method === 'POST') {
                                            result = await window.aiWrapperAPI.processQuery(
                                                body.query, 
                                                body.mode || 'factual', 
                                                body.options || {}
                                            );
                                        }
                                        break;
                                        
                                    case 'ratios':
                                        if (options.method === 'PUT') {
                                            result = await window.aiWrapperAPI.updateRatios(body);
                                        }
                                        break;
                                        
                                    case 'health':
                                        result = await window.aiWrapperAPI.getHealthStatus();
                                        break;
                                        
                                    case 'audit':
                                        result = await window.aiWrapperAPI.getAuditLog(body.limit);
                                        break;
                                        
                                    default:
                                        result = { success: false, error: 'Endpoint not found' };
                                }
                                
                                // Simulation de r√©ponse HTTP
                                return new Response(JSON.stringify(result), {
                                    status: result.success !== false ? 200 : 400,
                                    headers: { 'Content-Type': 'application/json' }
                                });
                                
                            } catch (error) {
                                return new Response(JSON.stringify({ 
                                    success: false, 
                                    error: error.message 
                                }), {
                                    status: 500,
                                    headers: { 'Content-Type': 'application/json' }
                                });
                            }
                        }
                        
                        // Si ce n'est pas notre API, utiliser fetch normal
                        return originalFetch(url, options);
                    };
                },
                
                // Simulation de traitement IA avec ratios adaptatifs
                async simulateAIProcessing(query, mode) {
                    // D√©lai de traitement r√©aliste
                    await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500));
                    
                    const activeModels = this.aiModels.filter(m => m.status === 'active');
                    const ratioSum = activeModels.reduce((sum, model) => {
                        const ratio = model.ratios[mode] || 0.33;
                        return sum + ratio * (model.priority / 10);
                    }, 0);
                    
                    // Calcul des ratios normalis√©s
                    const modelContributions = activeModels.map(model => {
                        const baseRatio = model.ratios[mode] || 0.33;
                        const weightedRatio = (baseRatio * (model.priority / 10)) / ratioSum;
                        
                        return {
                            name: model.name,
                            ratio: Math.min(weightedRatio, 1),
                            accuracy: model.accuracy
                        };
                    });
                    
                    // G√©n√©ration de r√©ponse simul√©e
                    const responses = {
                        factual: [
                            "Bas√© sur les donn√©es fiables, la r√©ponse est pr√©cise et v√©rifi√©e par nos mod√®les de confiance.",
                            "Selon nos sources v√©rifi√©es, cette information a √©t√© valid√©e par plusieurs mod√®les IA.",
                            "R√©ponse factuelle confirm√©e avec un niveau de confiance √©lev√©."
                        ],
                        creative: [
                            "Voici une approche cr√©ative qui combine imagination et logique pour cette question.",
                            "En explorant diff√©rentes perspectives, nos mod√®les proposent une r√©ponse innovante.",
                            "R√©ponse cr√©ative g√©n√©r√©e par fusion de plusieurs approches IA."
                        ],
                        hybrid: [
                            "Cette r√©ponse √©quilibre faits v√©rifi√©s et approches cr√©atives.",
                            "Analyse hybride combinant pr√©cision factuelle et innovation conceptuelle.",
                            "Synth√®se adaptative de nos meilleurs mod√®les pour une r√©ponse optimale."
                        ]
                    };
                    
                    const finalResponse = responses[mode][Math.floor(Math.random() * responses[mode].length)];
                    
                    // Calcul du score de confiance
                    const avgAccuracy = modelContributions.reduce((sum, model) => 
                        sum + (model.accuracy * model.ratio), 0
                    );
                    
                    const confidenceScore = Math.round(avgAccuracy * (0.85 + Math.random() * 0.15));
                    
                    return {
                        finalResponse,
                        modelContributions,
                        confidenceScore,
                        processingMode: mode,
                        timestamp: new Date().toISOString(),
                        queryLength: query.length
                    };
                },
                
                // Traitement d'une requ√™te utilisateur
                async processQuery() {
                    if (!this.userQuery.trim()) {
                        alert('Veuillez saisir une requ√™te');
                        return;
                    }
                    
                    this.isProcessing = true;
                    
                    try {
                        const response = await fetch('/api/v1/wrapper', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                query: this.userQuery,
                                mode: this.processingMode,
                                options: { max_tokens: 500 }
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            this.lastResult = result.data;
                            this.lastResult.processingTime = result.processingTime;
                        } else {
                            console.error('API Error:', result.error);
                        }
                        
                    } catch (error) {
                        console.error('Processing Error:', error);
                    } finally {
                        this.isProcessing = false;
                    }
                },
                
                // Toggle status d'un mod√®le
                toggleModel(modelId) {
                    const model = this.aiModels.find(m => m.id === modelId);
                    if (model) {
                        model.status = model.status === 'active' ? 'inactive' : 'active';
                        this.activeModels = this.aiModels.filter(m => m.status === 'active').length;
                    }
                },
                
                // Sauvegarde de la configuration des ratios
                async saveRatioConfig() {
                    const ratioConfig = {};
                    this.aiModels.forEach(model => {
                        ratioConfig[model.id] = {
                            ratios: model.ratios,
                            priority: model.priority,
                            status: model.status
                        };
                    });
                    
                    try {
                        const response = await fetch('/api/v1/ratios', {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(ratioConfig)
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            alert('Configuration sauvegard√©e avec succ√®s !');
                        } else {
                            alert('Erreur lors de la sauvegarde');
                        }
                    } catch (error) {
                        console.error('Save Error:', error);
                    }
                },
                
                // Couleur du mode dans l'audit
                getModeColor(mode) {
                    const colors = {
                        factual: 'bg-blue-600 text-white',
                        creative: 'bg-purple-600 text-white',
                        hybrid: 'bg-green-600 text-white'
                    };
                    return colors[mode] || 'bg-gray-600 text-white';
                },
                
                // Voir les d√©tails d'une entr√©e d'audit
                viewDetails(entryId) {
                    const entry = this.auditLog.find(e => e.id === entryId);
                    if (entry) {
                        alert(`D√©tails de la requ√™te:\n\nID: ${entry.id}\nRequ√™te: ${entry.query}\nMode: ${entry.mode}\nConfiance: ${entry.confidence}%\nTemps: ${entry.timestamp}`);
                    }
                },
                
                // Mise √† jour des m√©triques
                updateMetrics(result) {
                    // Simulation de mise √† jour des m√©triques en temps r√©el
                    this.avgResponseTime = Math.round((this.avgResponseTime * 0.9) + (result.processingTime * 0.1));
                    this.accuracyRate = Math.round(((this.accuracyRate * 0.95) + (result.confidenceScore * 0.05)) * 10) / 10;
                    this.hallucinationRate = Math.round((100 - this.accuracyRate) * 10) / 10;
                    
                    // Mise √† jour des m√©triques API
                    this.apiMetrics.requestsToday++;
                    this.apiMetrics.avgResponseTime = this.avgResponseTime;
                    
                    // Ajout √† l'historique des requ√™tes r√©centes
                    this.recentRequests.unshift({
                        id: Date.now(),
                        path: '/api/v1/wrapper',
                        status: 200
                    });
                    if (this.recentRequests.length > 10) this.recentRequests.pop();
                },
                
                // Mise √† jour du graphique de performance
                updatePerformanceChart() {
                    const ctx = document.getElementById('performanceChart')?.getContext('2d');
                    if (!ctx) return;
                    
                    // Donn√©es simul√©es pour le graphique
                    const labels = [];
                    const accuracyData = [];
                    const responseTimeData = [];
                    
                    for (let i = 23; i >= 0; i--) {
                        const time = dayjs().subtract(i, 'hour').format('HH:mm');
                        labels.push(time);
                        accuracyData.push(90 + Math.random() * 10);
                        responseTimeData.push(200 + Math.random() * 100);
                    }
                    
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Pr√©cision (%)',
                                data: accuracyData,
                                borderColor: '#10B981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4,
                                yAxisID: 'y'
                            }, {
                                label: 'Temps de R√©ponse (ms)',
                                data: responseTimeData,
                                borderColor: '#8B5CF6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                tension: 0.4,
                                yAxisID: 'y1'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: { color: '#E5E7EB' }
                                }
                            },
                            scales: {
                                x: {
                                    ticks: { color: '#9CA3AF' },
                                    grid: { color: 'rgba(156, 163, 175, 0.1)' }
                                },
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    ticks: { color: '#10B981' },
                                    grid: { color: 'rgba(16, 185, 129, 0.1)' }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    ticks: { color: '#8B5CF6' },
                                    grid: { drawOnChartArea: false }
                                }
                            }
                        }
                    });
                },
                
                // Mise √† jour en temps r√©el
                startRealTimeUpdates() {
                    setInterval(() => {
                        // Simulation de nouvelles donn√©es
                        if (Math.random() > 0.7) {
                            this.totalRequests++;
                            
                            // Mise √† jour al√©atoire des m√©triques
                            this.accuracyRate += (Math.random() - 0.5) * 0.2;
                            this.accuracyRate = Math.max(90, Math.min(100, this.accuracyRate));
                            this.hallucinationRate = 100 - this.accuracyRate;
                            
                            this.avgResponseTime += (Math.random() - 0.5) * 20;
                            this.avgResponseTime = Math.max(150, Math.min(500, this.avgResponseTime));
                        }
                    }, 3000);
                }
            }
        }).mount('#app');
        
        // Initialisation globale apr√®s chargement
        window.addEventListener('load', () => {
            console.log('ü§ñ AI Ratio Wrapper System Ready');
            console.log('üåê API Endpoints Available:');
            console.log('  POST /api/v1/wrapper - Main AI processing');
            console.log('  PUT  /api/v1/ratios - Update ratios configuration');
            console.log('  GET  /api/v1/health - System health check');
            console.log('  GET  /api/v1/audit - Audit logs');
        });
    </script>
</body>
</html>