<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ILN + NEXUS AXION - D√©monstration Pratique</title>
    <style>
        :root {
            --primary-color: #0a0a23; --secondary-color: #1b1b32; --accent-color: #f1be32;
            --text-color: #f5f6f7; --border-color: #3b3b4f; --success-color: #a2cc8c; --error-color: #f7a8a8;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--primary-color); color: var(--text-color); margin: 0; padding: 20px; line-height: 1.6;
        }
        main { max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; gap: 25px; }
        h1, h2 { border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; color: var(--accent-color); }
        h1 { text-align: center; }
        .module { background-color: var(--secondary-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; }
        .module h2 { margin-top: 0; font-size: 1.5em; }
        button { background-color: var(--accent-color); color: var(--primary-color); border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; }
        button:hover { background-color: #ffde7a; }
        input, textarea { width: calc(100% - 22px); padding: 10px; background-color: var(--primary-color); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 5px; margin-bottom: 10px; }
        pre { background-color: var(--primary-color); padding: 15px; border-radius: 5px; border: 1px solid var(--border-color); white-space: pre-wrap; word-wrap: break-word; font-family: "Courier New", Courier, monospace; max-height: 200px; overflow-y: auto; }
        .status { font-style: italic; color: #aaa; }
        .success { color: var(--success-color); }
        .error { color: var(--error-color); }
    </style>
</head>
<body>
    <main>
        <header>
            <h1>üöÄ ILN + NEXUS AXION - D√©monstration Pratique</h1>
            <p style="text-align: center;">Une application Enterprise compl√®te dans un seul fichier HTML.</p>
        </header>

        <section class="module">
            <h2>üåç Module 1: Communication Externe via CDN Proxy</h2>
            <p>Appelez n'importe quelle API externe sans probl√®me de CORS gr√¢ce √† un proxy Vercel.</p>
            <input type="text" id="apiUrl" value="https://api.github.com/users/vercel">
            <button id="callApiBtn">Appeler l'API Externe</button>
            <pre id="apiResult">Les r√©sultats de l'API appara√Ætront ici...</pre>
        </section>

        <section class="module">
            <h2>‚öôÔ∏è Module 2: Calculs Haute Performance (JS Optimis√©)</h2>
            <p>D√©monstration de la parall√©lisation native avec les Web Workers.</p>
            <button id="runPerfCalcBtn">Lancer un calcul parall√®le sur 1M de points</button>
            <pre id="perfCalcResult">Les r√©sultats du calcul appara√Ætront ici...</pre>
        </section>
        
        <section class="module">
            <h2>üì¶ Module 3: Backend JS & Base de Donn√©es (IndexedDB)</h2>
            <p>Simulation d'un backend e-commerce avec une base de donn√©es transactionnelle IndexedDB.</p>
            <input type="text" id="productName" placeholder="Nom du produit...">
            <button id="saveProductBtn">Ajouter au panier</button>
            <button id="viewCartBtn">Voir le panier</button>
            <pre id="dbResult">Le contenu du panier appara√Ætra ici...</pre>
        </section>

        <section class="module">
            <h2>üîí Module 4: S√©curit√© Enterprise Native (Web Crypto API)</h2>
            <p>Utilisation de l'API Web Crypto native pour des op√©rations de hachage s√©curis√©es.</p>
            <textarea id="secureMessage" rows="2" placeholder="Entrez un message √† s√©curiser..."></textarea>
            <button id="hashMessageBtn">Hacher le message (SHA-256)</button>
            <pre id="cryptoResult">Le hash s√©curis√© du message appara√Ætra ici...</pre>
        </section>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        class UniversalHTMLOS {
            constructor() {
                this.ui = new UIManager();
                this.backend = new OptimizedHTMLBackend();
                this.init();
            }
            init() {
                this.ui.bindEventListeners(this);
                this.backend.db.init();
            }
            async testExternalAPI(url) {
                this.ui.updateApiResult("‚è≥ Appel en cours...", "status");
                try {
                    const data = await this.backend.api.callExternalAPI(url);
                    this.ui.updateApiResult(JSON.stringify(data, null, 2), "success");
                } catch (error) {
                    this.ui.updateApiResult(`‚ùå Erreur: ${error.message}.`, "error");
                }
            }
            async testHighPerformanceCalc() {
                this.ui.updatePerfCalcResult("‚è≥ Calcul en cours...", "status");
                const data = Array.from({ length: 1_000_000 }, () => Math.random() * 100);
                try {
                    const startTime = performance.now();
                    const result = await this.backend.compute.processLargeDataset(data);
                    const endTime = performance.now();
                    const output = `‚úÖ Calcul termin√© en ${((endTime - startTime)).toFixed(2)} ms.\n- Moyenne: ${result.mean.toFixed(4)}\n- √âcart type: ${result.stdDev.toFixed(4)}`;
                    this.ui.updatePerfCalcResult(output, "success");
                } catch (error) {
                    this.ui.updatePerfCalcResult(`‚ùå Erreur: ${error.message}`, "error");
                }
            }
            async testDatabaseSave(productName) {
                if (!productName) return;
                const product = { id: Date.now(), name: productName, price: Math.floor(Math.random() * 100) + 10 };
                await this.backend.db.addItem('cart', product);
                this.ui.updateDbResult(`‚úÖ "${productName}" ajout√©.`, "success");
            }
            async testDatabaseView() {
                const cart = await this.backend.db.getAllItems('cart');
                this.ui.updateDbResult(cart.length > 0 ? JSON.stringify(cart, null, 2) : "üõí Panier vide.", "success");
            }
            async testCryptoHash(message) {
                if (!message) return;
                const hash = await this.backend.auth.hashData(message);
                this.ui.updateCryptoResult(`Message: "${message}"\n\n‚úÖ Hash SHA-256:\n${hash}`, "success");
            }
        }

        class OptimizedHTMLBackend {
            constructor() {
                this.db = new IndexedDBManager('AppDatabase');
                this.api = new CORSFreeAPI();
                this.auth = new CryptoAPIAuth();
                this.compute = new HighPerformanceJS();
            }
        }
        
        class CORSFreeAPI {
            async callExternalAPI(targetUrl, options = {}) {
                // LIGNE CRUCIALE CORRIG√âE :
                const proxyUrl = `/api/proxy?url=${encodeURIComponent(targetUrl)}`;
                console.log(`Appel via le proxy Vercel : ${proxyUrl}`);
                const response = await fetch(proxyUrl, options);
                if (!response.ok) {
                    throw new Error(`Erreur r√©seau via proxy: ${response.status} ${response.statusText}`);
                }
                return await response.json();
            }
        }

        class HighPerformanceJS {
            constructor() {
                const workerCode = `self.onmessage = e => {
                    const data = e.data, len = data.length;
                    if (!data || len === 0) { self.postMessage({ mean: 0, stdDev: 0 }); return; }
                    const mean = data.reduce((a, b) => a + b, 0) / len;
                    const stdDev = Math.sqrt(data.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b, 0) / len);
                    self.postMessage({ mean, stdDev });
                };`;
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                this.worker = new Worker(URL.createObjectURL(blob));
            }
            processLargeDataset(data) {
                return new Promise((resolve, reject) => {
                    this.worker.onmessage = e => resolve(e.data);
                    this.worker.onerror = e => reject(e);
                    this.worker.postMessage(data);
                });
            }
        }
        
        class IndexedDBManager {
            constructor(dbName) { this.dbName = dbName; this.db = null; }
            init() {
                return new Promise((resolve, reject) => {
                    const req = indexedDB.open(this.dbName, 1);
                    req.onerror = () => reject("Erreur DB");
                    req.onsuccess = e => { this.db = e.target.result; resolve(); };
                    req.onupgradeneeded = e => e.target.result.createObjectStore('cart', { keyPath: 'id' });
                });
            }
            addItem(storeName, item) {
                return new Promise((resolve, reject) => {
                    const req = this.db.transaction([storeName], 'readwrite').objectStore(storeName).add(item);
                    req.onsuccess = resolve;
                    req.onerror = e => reject(e.target.error);
                });
            }
            getAllItems(storeName) {
                return new Promise((resolve, reject) => {
                    const req = this.db.transaction([storeName], 'readonly').objectStore(storeName).getAll();
                    req.onsuccess = () => resolve(req.result);
                    req.onerror = e => reject(e.target.error);
                });
            }
        }
        
        class CryptoAPIAuth {
            async hashData(data) {
                const hashBuffer = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(data));
                return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
            }
        }

        class UIManager {
            constructor() {
                this.elements = {
                    callApiBtn: document.getElementById('callApiBtn'), apiUrl: document.getElementById('apiUrl'), apiResult: document.getElementById('apiResult'),
                    runPerfCalcBtn: document.getElementById('runPerfCalcBtn'), perfCalcResult: document.getElementById('perfCalcResult'),
                    saveProductBtn: document.getElementById('saveProductBtn'), productName: document.getElementById('productName'), viewCartBtn: document.getElementById('viewCartBtn'), dbResult: document.getElementById('dbResult'),
                    hashMessageBtn: document.getElementById('hashMessageBtn'), secureMessage: document.getElementById('secureMessage'), cryptoResult: document.getElementById('cryptoResult'),
                };
            }
            bindEventListeners(app) {
                this.elements.callApiBtn.onclick = () => app.testExternalAPI(this.elements.apiUrl.value);
                this.elements.runPerfCalcBtn.onclick = () => app.testHighPerformanceCalc();
                this.elements.saveProductBtn.onclick = () => { app.testDatabaseSave(this.elements.productName.value); this.elements.productName.value = ''; };
                this.elements.viewCartBtn.onclick = () => app.testDatabaseView();
                this.elements.hashMessageBtn.onclick = () => app.testCryptoHash(this.elements.secureMessage.value);
            }
            _updateResult(element, text, type) { element.textContent = text; element.className = type; }
            updateApiResult(t, c) { this._updateResult(this.elements.apiResult, t, c); }
            updatePerfCalcResult(t, c) { this._updateResult(this.elements.perfCalcResult, t, c); }
            updateDbResult(t, c) { this._updateResult(this.elements.dbResult, t, c); }
            updateCryptoResult(t, c) { this._updateResult(this.elements.cryptoResult, t, c); }
        }
        new UniversalHTMLOS();
    });
    </script>
</body>
</html>