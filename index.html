<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Telegram Bot Builder</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:wght@400;500;700&display=swap');

:root {
  --bg: #fafaf9;
  --surface: #ffffff;
  --border: #e7e5e4;
  --text: #1c1917;
  --muted: #78716c;
  --accent: #2563eb;
  --accent-light: #dbeafe;
  --success: #16a34a;
  --success-light: #dcfce7;
  --amber: #f59e0b;
  --amber-light: #fef3c7;
  --red: #dc2626;
  --shadow: rgba(0,0,0,0.04);
  --shadow-md: rgba(0,0,0,0.08);
  --radius: 16px;
  --serif: 'Instrument Serif', serif;
  --sans: 'DM Sans', sans-serif;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: var(--sans);
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
  padding-bottom: 2rem;
}

/* Header */
header {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 1.25rem 1.5rem;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(12px);
  background: rgba(255,255,255,0.85);
}

.logo {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.logo-icon {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, #2563eb, #3b82f6);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.logo-icon svg { width: 20px; height: 20px; fill: white; }

.logo-text h1 {
  font-family: var(--serif);
  font-size: 1.125rem;
  font-weight: 400;
  font-style: italic;
  letter-spacing: -0.3px;
}

.logo-text span {
  font-size: 0.75rem;
  color: var(--muted);
}

/* Container */
.container {
  max-width: 640px;
  margin: 0 auto;
  padding: 1.5rem;
}

/* Section */
.section {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 1px 3px var(--shadow);
}

.section-title {
  font-family: var(--serif);
  font-size: 1.125rem;
  font-style: italic;
  margin-bottom: 1.25rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.section-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

/* Form */
.field {
  margin-bottom: 1.25rem;
}

.field:last-child { margin-bottom: 0; }

label {
  display: block;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text);
  margin-bottom: 0.5rem;
  letter-spacing: -0.2px;
}

label .required {
  color: var(--red);
  margin-left: 2px;
}

input[type="text"],
input[type="password"],
textarea {
  width: 100%;
  padding: 0.875rem 1rem;
  border: 1.5px solid var(--border);
  border-radius: 12px;
  font-family: var(--sans);
  font-size: 0.9375rem;
  background: var(--surface);
  transition: all 0.2s;
  color: var(--text);
}

input:focus,
textarea:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-light);
}

textarea {
  resize: vertical;
  min-height: 70px;
  line-height: 1.5;
}

.hint {
  font-size: 0.8125rem;
  color: var(--muted);
  margin-top: 0.375rem;
}

/* Function card */
.function-card {
  border: 1.5px solid var(--border);
  border-radius: 12px;
  padding: 1rem;
  margin-bottom: 1rem;
  background: var(--bg);
  transition: all 0.2s;
}

.function-card.active {
  border-color: var(--accent);
  background: var(--accent-light);
}

.function-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

.function-name {
  font-weight: 600;
  font-size: 0.9375rem;
  letter-spacing: -0.2px;
}

.function-desc {
  font-size: 0.8125rem;
  color: var(--muted);
  margin-bottom: 0.75rem;
  line-height: 1.5;
}

/* Toggle switch */
.toggle {
  position: relative;
  width: 44px;
  height: 24px;
  cursor: pointer;
}

.toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  inset: 0;
  background: #d6d3d1;
  border-radius: 12px;
  transition: all 0.3s;
}

.toggle-slider::before {
  content: '';
  position: absolute;
  width: 18px;
  height: 18px;
  left: 3px;
  top: 3px;
  background: white;
  border-radius: 50%;
  transition: all 0.3s;
  box-shadow: 0 1px 3px rgba(0,0,0,0.15);
}

.toggle input:checked + .toggle-slider {
  background: var(--accent);
}

.toggle input:checked + .toggle-slider::before {
  transform: translateX(20px);
}

/* Buttons */
.btn {
  width: 100%;
  padding: 1rem 1.5rem;
  border-radius: 12px;
  font-family: var(--sans);
  font-size: 0.9375rem;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
  letter-spacing: -0.2px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.btn-primary {
  background: var(--accent);
  color: white;
  box-shadow: 0 1px 3px var(--shadow-md);
}

.btn-primary:active {
  transform: scale(0.98);
}

.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-secondary {
  background: var(--surface);
  border: 1.5px solid var(--border);
  color: var(--text);
}

/* Status banner */
.status-banner {
  padding: 1rem;
  border-radius: 12px;
  font-size: 0.875rem;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  line-height: 1.5;
}

.status-banner.info {
  background: var(--accent-light);
  color: var(--accent);
  border: 1px solid var(--accent);
}

.status-banner.success {
  background: var(--success-light);
  color: var(--success);
  border: 1px solid var(--success);
}

.status-banner.warning {
  background: var(--amber-light);
  color: #92400e;
  border: 1px solid var(--amber);
}

.status-banner svg {
  flex-shrink: 0;
  margin-top: 1px;
}

/* Steps */
.steps {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1.5rem;
  padding: 0 0.5rem;
}

.step {
  flex: 1;
  height: 3px;
  background: var(--border);
  border-radius: 2px;
  transition: all 0.3s;
}

.step.active { background: var(--accent); }

/* Loading spinner */
.spinner {
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Code display */
.code-block {
  background: #1c1917;
  color: #fafaf9;
  padding: 1rem;
  border-radius: 12px;
  font-family: 'Courier New', monospace;
  font-size: 0.8125rem;
  overflow-x: auto;
  line-height: 1.6;
  margin-top: 1rem;
}

.code-block::-webkit-scrollbar { height: 6px; }
.code-block::-webkit-scrollbar-track { background: transparent; }
.code-block::-webkit-scrollbar-thumb { background: #57534e; border-radius: 3px; }

/* Expandable */
.expandable-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out;
}

.expandable-content.open {
  max-height: 500px;
}

/* Mobile optimization */
@media (max-width: 640px) {
  .container { padding: 1rem; }
  .section { padding: 1.25rem; }
  header { padding: 1rem 1.25rem; }
}

/* Floating deploy button on mobile */
@media (max-width: 640px) {
  .deploy-sticky {
    position: fixed;
    bottom: 1rem;
    left: 1rem;
    right: 1rem;
    z-index: 50;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  }
}
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-icon">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.447 1.394c-.16.16-.295.295-.605.295l.213-3.053 5.56-5.023c.242-.213-.054-.333-.373-.12L7.394 13.9l-2.967-.924c-.643-.204-.657-.643.136-.953l11.57-4.461c.537-.194 1.006.131.761.659z"/>
      </svg>
    </div>
    <div class="logo-text">
      <h1>Bot Builder</h1>
      <span>No code Â· Deploy instantly</span>
    </div>
  </div>
</header>

<div class="container">
  <!-- Steps -->
  <div class="steps">
    <div class="step active" id="step-1"></div>
    <div class="step" id="step-2"></div>
    <div class="step" id="step-3"></div>
  </div>

  <!-- Status -->
  <div class="status-banner info" id="status-banner">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
    </svg>
    <div>Configure your bot credentials, choose functions, then deploy to Cloudflare Workers in one click.</div>
  </div>

  <!-- Config -->
  <div class="section">
    <div class="section-title">Credentials</div>

    <div class="field">
      <label>Telegram Bot Token <span class="required">*</span></label>
      <input type="password" id="telegram-token" placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
      <div class="hint">Get from @BotFather on Telegram</div>
    </div>

    <div class="field">
      <label>Cloudflare API Token <span class="required">*</span></label>
      <input type="password" id="cf-token" placeholder="Your Cloudflare API token">
      <div class="hint">Create at cloudflare.com â†’ My Profile â†’ API Tokens</div>
    </div>

    <div class="field">
      <label>Cloudflare Account ID <span class="required">*</span></label>
      <input type="text" id="cf-account" placeholder="abc123def456">
      <div class="hint">Find in Cloudflare dashboard â†’ Workers & Pages</div>
    </div>

    <div class="field">
      <label>Worker Name</label>
      <input type="text" id="worker-name" placeholder="my-telegram-bot" value="telegram-bot">
      <div class="hint">Lowercase, no spaces</div>
    </div>
  </div>

  <!-- Functions -->
  <div class="section">
    <div class="section-title">Bot Functions</div>

    <!-- /start -->
    <div class="function-card" data-func="start">
      <div class="function-header">
        <div class="function-name">/start command</div>
        <label class="toggle">
          <input type="checkbox" checked data-toggle="start">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="function-desc">First message users see when starting the bot</div>
      <div class="expandable-content open">
        <textarea id="msg-start" placeholder="Welcome message">Hello! I'm your bot. Use /help to see available commands.</textarea>
      </div>
    </div>

    <!-- /help -->
    <div class="function-card" data-func="help">
      <div class="function-header">
        <div class="function-name">/help command</div>
        <label class="toggle">
          <input type="checkbox" checked data-toggle="help">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="function-desc">Shows available commands</div>
      <div class="expandable-content open">
        <textarea id="msg-help" placeholder="Help message">Available commands:
/start - Start the bot
/help - Show this help
/ping - Check bot status</textarea>
      </div>
    </div>

    <!-- Welcome new members -->
    <div class="function-card" data-func="welcome">
      <div class="function-header">
        <div class="function-name">Welcome new members</div>
        <label class="toggle">
          <input type="checkbox" data-toggle="welcome">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="function-desc">Auto-greet when someone joins the group</div>
      <div class="expandable-content">
        <textarea id="msg-welcome" placeholder="Welcome message">Welcome {name} to the group! ðŸ‘‹</textarea>
        <div class="hint" style="margin-top:0.5rem">Use {name} for member's name</div>
      </div>
    </div>

    <!-- Auto-reply -->
    <div class="function-card" data-func="autoreply">
      <div class="function-header">
        <div class="function-name">Auto-reply to all messages</div>
        <label class="toggle">
          <input type="checkbox" data-toggle="autoreply">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="function-desc">Reply to non-command messages</div>
      <div class="expandable-content">
        <textarea id="msg-autoreply" placeholder="Auto-reply message">Got your message: "{text}"</textarea>
        <div class="hint" style="margin-top:0.5rem">Use {text} for user's message</div>
      </div>
    </div>

    <!-- /ping -->
    <div class="function-card" data-func="ping">
      <div class="function-header">
        <div class="function-name">/ping command</div>
        <label class="toggle">
          <input type="checkbox" checked data-toggle="ping">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="function-desc">Check if bot is responsive</div>
      <div class="expandable-content open">
        <textarea id="msg-ping" placeholder="Ping response">Pong! Bot is alive and running.</textarea>
      </div>
    </div>
  </div>

  <!-- Deploy button -->
  <button class="btn btn-primary" id="btn-deploy" onclick="deployBot()">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/>
    </svg>
    Deploy to Cloudflare
  </button>

  <!-- Generated code preview -->
  <div class="section" id="code-preview" style="display:none;">
    <div class="section-title">Generated Worker Code</div>
    <div class="code-block" id="code-display"></div>
    <button class="btn btn-secondary" onclick="copyCode()" style="margin-top:1rem">
      Copy Code
    </button>
  </div>

</div>

<script>
// ================================================================
// STATE
// ================================================================

let config = {
  telegramToken: '',
  cfToken: '',
  cfAccount: '',
  workerName: 'telegram-bot',
  functions: {}
};

// ================================================================
// TOGGLE EXPANDABLES
// ================================================================

document.querySelectorAll('[data-toggle]').forEach(toggle => {
  toggle.addEventListener('change', (e) => {
    const func = e.target.dataset.toggle;
    const card = document.querySelector(`[data-func="${func}"]`);
    const content = card.querySelector('.expandable-content');
    
    if (e.target.checked) {
      content.classList.add('open');
      card.classList.add('active');
    } else {
      content.classList.remove('open');
      card.classList.remove('active');
    }
  });
});

// ================================================================
// GENERATE WORKER CODE
// ================================================================

function generateWorkerCode() {
  const token = document.getElementById('telegram-token').value;
  const functions = {};
  
  document.querySelectorAll('[data-toggle]').forEach(toggle => {
    if (toggle.checked) {
      const func = toggle.dataset.toggle;
      const msgId = `msg-${func}`;
      functions[func] = document.getElementById(msgId)?.value || '';
    }
  });

  return `// Generated by Telegram Bot Builder
// Deploy to Cloudflare Workers

const TELEGRAM_TOKEN = '${token}';
const API = \`https://api.telegram.org/bot\${TELEGRAM_TOKEN}\`;

const FUNCTIONS = ${JSON.stringify(functions, null, 2)};

export default {
  async fetch(request) {
    if (request.method !== 'POST') {
      return new Response('OK', { status: 200 });
    }

    try {
      const update = await request.json();
      await handleUpdate(update);
    } catch (e) {
      console.error('Error:', e);
    }

    return new Response('OK', { status: 200 });
  }
};

async function handleUpdate(update) {
  const message = update.message;
  if (!message) return;

  const chatId = message.chat.id;
  const text = message.text || '';
  const newMember = message.new_chat_member;

  // Welcome new member
  if (newMember && FUNCTIONS.welcome) {
    const name = newMember.first_name || 'User';
    const msg = FUNCTIONS.welcome.replace('{name}', name);
    await sendMessage(chatId, msg);
    return;
  }

  // Commands
  if (text.startsWith('/')) {
    const cmd = text.split(' ')[0].toLowerCase().slice(1);
    if (FUNCTIONS[cmd]) {
      await sendMessage(chatId, FUNCTIONS[cmd]);
      return;
    }
  }

  // Auto-reply
  if (FUNCTIONS.autoreply) {
    const msg = FUNCTIONS.autoreply.replace('{text}', text);
    await sendMessage(chatId, msg);
  }
}

async function sendMessage(chatId, text) {
  await fetch(\`\${API}/sendMessage\`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ chat_id: chatId, text })
  });
}`;
}

// ================================================================
// DEPLOY
// ================================================================

async function deployBot() {
  const btn = document.getElementById('btn-deploy');
  const status = document.getElementById('status-banner');
  
  // Validate
  const telegramToken = document.getElementById('telegram-token').value.trim();
  const cfToken = document.getElementById('cf-token').value.trim();
  const cfAccount = document.getElementById('cf-account').value.trim();
  const workerName = document.getElementById('worker-name').value.trim();

  if (!telegramToken || !cfToken || !cfAccount) {
    showStatus('warning', 'Please fill in all required credentials.');
    return;
  }

  // Generate code
  const workerCode = generateWorkerCode();

  // Show code preview
  document.getElementById('code-display').textContent = workerCode;
  document.getElementById('code-preview').style.display = 'block';

  // Deploy
  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div> Deploying...';
  
  showStatus('info', 'Deploying to Cloudflare Workers...');
  updateStep(2);

  try {
    // Upload worker
    const uploadRes = await fetch(
      `https://api.cloudflare.com/client/v4/accounts/${cfAccount}/workers/scripts/${workerName}`,
      {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${cfToken}`,
          'Content-Type': 'application/javascript'
        },
        body: workerCode
      }
    );

    if (!uploadRes.ok) {
      const err = await uploadRes.json();
      throw new Error(err.errors?.[0]?.message || 'Deploy failed');
    }

    updateStep(3);
    showStatus('info', 'Setting webhook...');

    // Set webhook
    const webhookUrl = `https://${workerName}.${cfAccount}.workers.dev`;
    const webhookRes = await fetch(
      `https://api.telegram.org/bot${telegramToken}/setWebhook`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url: webhookUrl })
      }
    );

    const webhookData = await webhookRes.json();
    if (!webhookData.ok) {
      throw new Error(webhookData.description || 'Webhook failed');
    }

    // Success
    showStatus('success', `âœ… Bot deployed! Live at: ${webhookUrl}`);
    btn.innerHTML = 'âœ… Deployed Successfully';
    
  } catch (e) {
    showStatus('warning', `Deployment failed: ${e.message}`);
    btn.disabled = false;
    btn.innerHTML = 'Retry Deploy';
  }
}

function showStatus(type, message) {
  const banner = document.getElementById('status-banner');
  banner.className = `status-banner ${type}`;
  banner.innerHTML = `
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      ${type === 'success' ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>' :
        type === 'warning' ? '<path d="m10.29 3.86-7.72 13a2 2 0 0 0 1.71 3h15.43a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>' :
        '<circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>'}
    </svg>
    <div>${message}</div>
  `;
}

function updateStep(n) {
  for (let i = 1; i <= 3; i++) {
    document.getElementById(`step-${i}`).classList.toggle('active', i <= n);
  }
}

function copyCode() {
  const code = document.getElementById('code-display').textContent;
  navigator.clipboard.writeText(code);
  alert('Code copied to clipboard!');
}

// ================================================================
// INIT
// ================================================================

showStatus('info', 'Configure your bot credentials, choose functions, then deploy to Cloudflare Workers in one click.');
</script>

</body>
</html>
